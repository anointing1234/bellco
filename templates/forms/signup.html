{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Sign Up - Belco Community Credit Union</title>
    <link rel="stylesheet" href="{% static 'assets/css/output.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/css/style.css' %}" />
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'images/favicon.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'images/favicon.png' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/aquawolf04/font-awesome-pro@5cd1511/css/all.css">

    <style>
      .logo-small { width: 150px; margin-top: 20px; }
      .illustration { max-height: 200px; width: auto; }
/* Modern Double Circle Spinner */
.modern-spinner {
  position: relative;
  width: 70px;
  height: 70px;
}

.outer-circle,
.inner-circle {
  position: absolute;
  border: 4px solid transparent;
  border-top-color: #00c853; /* Green */
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

.outer-circle {
  width: 70px;
  height: 70px;
  border-width: 4px;
}

.inner-circle {
  width: 40px;
  height: 40px;
  border-width: 3px;
  top: 15px;
  left: 15px;
  animation-duration: 1.5s; /* Slightly slower */
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

      @keyframes spinner-border { to { transform: rotate(360deg); } }
      .login-card { padding:20px; border-radius:30px; box-shadow:0 20px 40px rgba(255,255,255,0.1),0 10px 20px rgba(2,12,146,0.05);}
      @media (min-width:1024px){ .login-card{ max-width:500px; } }
      input[type="text"],input[type="email"],input[type="password"],input[type="tel"],select {
        height: 2rem !important; font-size: 0.888rem !important; padding: 0 0.5rem !important;
      }
      /* Stepper */
      .stepper { display:flex; justify-content:space-between; margin-bottom:20px; }
      .step { text-align:center; flex:1; position:relative; }
      .step:not(:last-child)::after {
        content:''; position:absolute; top:15px; right:-50%; width:100%; height:2px;
        background:#d1d5db; z-index:-1;
      }
      .circle {
        width:30px; height:30px; border-radius:50%; background:#d1d5db; margin:0 auto;
        display:flex; align-items:center; justify-content:center; font-size:14px; font-weight:bold; color:white;
      }
      .step.active .circle { background:#34D399; }
      .step.completed .circle { background:#34D399; }
      .step p { margin-top:5px; font-size:12px; }
      fieldset { display:none; }
      fieldset.active { display:block; }

      /* Reduce input and select height */
  input[type="text"],
  input[type="email"],
  input[type="password"],
  input[type="tel"],
  select {
    color:white;
  }

  button.next, button.prev, button[type="submit"] {
  transition: all 0.2s ease;
}
button.next:active, button.prev:active, button[type="submit"]:active {
  transform: scale(0.95);
}
button.next:hover, button.prev:hover, button[type="submit"]:hover {
  opacity: 0.9;
}

    </style>
<style>
.page-loading {
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 100%;
    transition: all 1.5s cubic-bezier(0.4, 0, 0.2, 1); /* slower fade */
    background: radial-gradient(ellipse at center, rgba(16,185,129,0.08) 0%, rgba(255,255,255,0.95) 50%, rgba(255,255,255,1) 100%);
    backdrop-filter: blur(2px);
    visibility: hidden;
    z-index: 9999;
}

.dark .page-loading {
    background: radial-gradient(ellipse at center, rgba(16,185,129,0.12) 0%, rgba(17,24,39,0.95) 50%, rgba(17,24,39,1) 100%);
}

.page-loading.active { opacity: 1; visibility: visible; }
.page-loading-inner { position: absolute; top:50%; left:50%; transform:translate(-50%, -50%); text-align:center; transition: all 1s cubic-bezier(0.4,0,0.2,1); opacity:0; }
.page-loading.active>.page-loading-inner { opacity:1; }

.loading-container { display:flex; align-items:center; justify-content:center; flex-direction:column; position:relative; }

/* Particles */
.loading-particles { position:absolute; width:300px; height:300px; top:50%; left:50%; transform:translate(-50%,-50%); pointer-events:none; }
.particle { position:absolute; width:4px; height:4px; border-radius:50%; background: linear-gradient(45deg,#10b981,#047857); opacity:0.6; animation: floatParticle 6s ease-in-out infinite; }
.particle:nth-child(1){top:20%;left:20%;animation-delay:0s;}
.particle:nth-child(2){top:80%;left:80%;animation-delay:0.7s;}
.particle:nth-child(3){top:60%;left:20%;animation-delay:1.4s;}
.particle:nth-child(4){top:30%;left:70%;animation-delay:2.1s;}
.particle:nth-child(5){top:70%;left:30%;animation-delay:2.8s;}
.particle:nth-child(6){top:10%;left:60%;animation-delay:3.5s;}

/* Loading animation */
.loading-animation { display:flex; align-items:center; justify-content:center; width:120px; height:120px; margin-bottom:2rem; position:relative; filter: drop-shadow(0 0 20px rgba(16,185,129,0.2)); }

/* Outer rings */
.loading-animation .orbit-ring { position:absolute; border-radius:50%; border:2px solid rgba(16,185,129,0.2); animation:rotateOrbit 12s linear infinite; }
.orbit-ring:nth-child(1){width:100%;height:100%;border-top:2px solid #10b981;border-right:2px solid rgba(16,185,129,0.3);animation-duration:3s;}
.orbit-ring:nth-child(2){width:80%;height:80%;top:10%;left:10%;border-bottom:2px solid #10b981;border-left:2px solid rgba(16,185,129,0.3);animation-duration:3.8s;animation-direction:reverse;}
.orbit-ring:nth-child(3){width:60%;height:60%;top:20%;left:20%;border-top:2px solid #10b981;border-right:2px solid rgba(16,185,129,0.3);animation-duration:4.5s;}

/* Inner circles */
.loading-animation .inner-circle { position:absolute;width:15px;height:15px;border-radius:50%; background:#10b981; box-shadow:0 0 10px rgba(16,185,129,0.6); animation:spinInner 3s cubic-bezier(0.5,0,0.5,1) infinite; }
.inner-circle:nth-child(4){border-top:3px solid #10b981;border-right:3px solid rgba(16,185,129,0.4); animation-delay:0s;}
.inner-circle:nth-child(5){border-bottom:3px solid #10b981;border-left:3px solid rgba(16,185,129,0.4); animation-delay:0.5s; animation-direction:reverse;}

/* Core */
.loading-animation .core { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:20px;height:20px; border-radius:50%; background:linear-gradient(45deg,#10b981,#047857); background-size:200% 200%; box-shadow:0 0 20px rgba(16,185,129,0.6),0 0 40px rgba(16,185,129,0.3), inset 0 0 10px rgba(255,255,255,0.3); animation: coreGlow 3s ease-in-out infinite, morphCore 6s ease-in-out infinite; }

/* Text & subtitle */
.page-loading .text { font-weight:700;letter-spacing:0.1em;margin-top:1.5rem;font-size:1.1rem;position:relative; background:linear-gradient(90deg,#10b981,#10b981,#047857,#10b981,#10b981); background-size:300% auto; -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; animation:textShimmer 6s linear infinite; text-shadow:0 0 30px rgba(16,185,129,0.3);}
.page-loading .text::before { content:''; position:absolute;top:-2px;left:-2px;right:-2px;bottom:-2px; background:linear-gradient(45deg,transparent,rgba(16,185,129,0.1),transparent); border-radius:4px; z-index:-1; animation:textGlow 4s ease-in-out infinite alternate; }
.page-loading .subtitle { font-size:0.75rem;color:#047857;font-weight:500;margin-top:0.5rem;letter-spacing:0.05em;animation:subtitleFade 4s ease-in-out infinite; }

/* Progress bar */
.loading-progress { width:200px;height:2px;background:rgba(4,120,87,0.2); border-radius:1px;margin-top:1.5rem; overflow:hidden; position:relative; }
.loading-progress::before { content:''; position:absolute; top:0; left:-100%; width:100%; height:100%; background:linear-gradient(90deg,transparent,#10b981,transparent); animation:progressSlide 4s ease-in-out infinite; }

/* Animations */
@keyframes floatParticle {0%,100%{transform:translateY(0) rotate(0deg);opacity:0.6;}50%{transform:translateY(-20px) rotate(180deg);opacity:1;}}
@keyframes rotateOrbit {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
@keyframes spinInner {0%{transform:rotate(0deg) scale(1);}50%{transform:rotate(180deg) scale(1.1);}100%{transform:rotate(360deg) scale(1);}}
@keyframes coreGlow {0%{transform:translate(-50%,-50%) scale(0.8);box-shadow:0 0 20px rgba(16,185,129,0.6),0 0 40px rgba(16,185,129,0.3), inset 0 0 10px rgba(255,255,255,0.3);}100%{transform:translate(-50%,-50%) scale(1.2);box-shadow:0 0 30px rgba(16,185,129,0.8),0 0 60px rgba(16,185,129,0.4), inset 0 0 15px rgba(255,255,255,0.5);}}
@keyframes morphCore {0%,100%{border-radius:50%;background-position:0% 50%;}25%{border-radius:40%;background-position:100% 50%;}50%{border-radius:30%;background-position:0% 50%;}75%{border-radius:40%;background-position:100% 50%;}}
@keyframes textShimmer {0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}
@keyframes textGlow {0%{opacity:0.3;}100%{opacity:0.7;}}
@keyframes subtitleFade {0%,100%{opacity:0.5;transform:translateY(0px);}50%{opacity:1;transform:translateY(-2px);}}
@keyframes progressSlide {0%{left:-100%;}50%{left:0%;}100%{left:100%;}}
</style>



  </head>
  <body class="bg-white dark:bg-darkblack-500">


      <!-- Ultra Modern Page Loader -->
    {% comment %} <div class="page-loading active">
        <div class="page-loading-inner">
            <div class="loading-container">
                <!-- Floating particles background -->
                <div class="loading-particles">
                    <div class="particle"></div>
                    <div class="particle"></div>
                    <div class="particle"></div>
                    <div class="particle"></div>
                    <div class="particle"></div>
                    <div class="particle"></div>
                </div>
                
                <!-- Main loading animation -->
                <div class="loading-animation">
                    <!-- Outer orbital rings -->
                    <div class="orbit-ring"></div>
                    <div class="orbit-ring"></div>
                    <div class="orbit-ring"></div>
                    
                    <!-- Inner spinning circles -->
                    <div class="inner-circle"></div>
                    <div class="inner-circle"></div>
                    
                    <!-- Morphing glowing core -->
                    <div class="core"></div>
                </div>
                
                <!-- Enhanced text with effects -->
                <div class="text">Belco Community Credit Union</div>
                <div class="subtitle">Secure Banking Platform</div>
                
                <!-- Progress indicator -->
                <div class="loading-progress"></div>
            </div>
        </div>
    </div> {% endcomment %}

    <!-- Spinner -->
<div id="spinner" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="modern-spinner">
    <div class="outer-circle"></div>
    <div class="inner-circle"></div>
  </div>
</div>
<section class="min-h-screen flex flex-col lg:flex-row">
  <div class="lg:w-1/2 flex flex-col justify-center px-4 xl:pl-8 py-6">
    <header class="text-center mb-6">
      <img class="logo-small mx-auto mb-6 block md:hidden" src="{% static 'images/logo_white.png' %}" alt="Belco Community Credit Union Logo"/>
      <h3 class="text-bgray-900 dark:text-white text-3xl font-semibold font-poppins mb-1">Create Account</h3>
      <p class="font-urbanis text-sm font-medium text-white">Follow the steps below</p>
    </header>

    <!-- Stepper -->
    <div class="stepper">
      <div class="step active" data-step="1">
        <div class="circle">1</div><p class="text-white">Personal</p>
      </div>
      <div class="step" data-step="2">
        <div class="circle">2</div><p class="text-white">Security</p>
      </div>
      <div class="step" data-step="3">
        <div class="circle">3</div><p class="text-white">2FA</p>
      </div>
    </div>

    <div class="w-full mx-auto login-card">
      <form id="signup" onsubmit="registration(event)">
        {% csrf_token %}

        <!-- Step 1: Personal Info -->
        <fieldset class="active" data-step="1">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <div>
              <label for="first_name" class="block text-xs font-medium text-bgray-600 dark:text-bgray-50 mb-1">First Name</label>
              <input id="first_name" name="first_name" type="text" placeholder="First Name" required
                class="text-bgray-800 dark:text-white dark:bg-darkblack-500 dark:border-darkblack-400 
                border border-bgray-300 h-10 w-full focus:border-success-300 focus:ring-0 rounded-lg 
                px-3 placeholder:text-bgray-500 placeholder:text-sm" />
            </div>
            <div>
              <label for="last_name" class="block text-xs font-medium text-bgray-600 dark:text-bgray-50 mb-1">Last Name</label>
              <input id="last_name" name="last_name" type="text" placeholder="Last Name" required
                class="text-bgray-800 dark:text-white dark:bg-darkblack-500 dark:border-darkblack-400 
                border border-bgray-300 h-10 w-full focus:border-success-300 focus:ring-0 rounded-lg 
                px-3 placeholder:text-bgray-500 placeholder:text-sm" />
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mt-3">
            <div>
              <label for="phone_number" class="block text-xs font-medium text-bgray-600 dark:text-bgray-50 mb-1">Phone Number</label>
              <input id="phone_number" name="phone_number" type="tel" placeholder="Phone Number" pattern="\+?[0-9]{10,15}" required
                class="text-bgray-800 dark:text-white dark:bg-darkblack-500 dark:border-darkblack-400 
                border border-bgray-300 h-10 w-full focus:border-success-300 focus:ring-0 rounded-lg 
                px-3 placeholder:text-bgray-500 placeholder:text-sm" />
            </div>
            <div>
              <label for="email" class="block text-xs font-medium text-bgray-600 dark:text-bgray-50 mb-1">Email</label>
              <input id="email" name="email" type="email" placeholder="Email" required
                class="text-bgray-800 dark:text-white dark:bg-darkblack-500 dark:border-darkblack-400 
                border border-bgray-300 h-10 w-full focus:border-success-300 focus:ring-0 rounded-lg 
                px-3 placeholder:text-bgray-500 placeholder:text-sm" />
            </div>
          </div>

          <!-- New Fields: Country & City -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mt-3">
            <div>
              <label for="country" class="block text-xs font-medium text-bgray-600 dark:text-bgray-50 mb-1">Country</label>
              <input id="country" name="country" type="text" placeholder="Country"
                class="text-bgray-800 dark:text-white dark:bg-darkblack-500 dark:border-darkblack-400 
                border border-bgray-300 h-10 w-full focus:border-success-300 focus:ring-0 rounded-lg 
                px-3 placeholder:text-bgray-500 placeholder:text-sm" />
            </div>
            <div>
              <label for="city" class="block text-xs font-medium text-bgray-600 dark:text-bgray-50 mb-1">City</label>
              <input id="city" name="city" type="text" placeholder="City"
                class="text-bgray-800 dark:text-white dark:bg-darkblack-500 dark:border-darkblack-400 
                border border-bgray-300 h-10 w-full focus:border-success-300 focus:ring-0 rounded-lg 
                px-3 placeholder:text-bgray-500 placeholder:text-sm" />
            </div>
          </div>

          <div class="mt-4 flex justify-end">
            <button type="button" class="next bg-success-300 text-white px-4 py-2 rounded">Next</button>
          </div>
        </fieldset>

        <!-- Step 2: Security Info -->
        <fieldset data-step="2">
          <div>
            <label for="gender" class="block text-xs font-medium text-bgray-600 dark:text-bgray-50 mb-1">Gender</label>
            <select id="gender" name="gender" required
              class="text-bgray-800 dark:text-white dark:bg-darkblack-500 dark:border-darkblack-400 
              border border-bgray-300 h-10 w-full focus:border-success-300 focus:ring-0 rounded-lg 
              px-3 placeholder:text-bgray-500 text-sm">
              <option value="" disabled selected>Select Gender</option>
              <option value="M">Male</option>
              <option value="F">Female</option>
              <option value="O">Other</option>
            </select>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mt-3">
            <div class="relative">
              <label for="password" class="block text-xs font-medium text-bgray-600 dark:text-bgray-50 mb-1">Password</label>
              <input id="password" name="password" type="password" placeholder="Password" required minlength="8"
                class="text-bgray-800 dark:text-white dark:bg-darkblack-500 dark:border-darkblack-400 
                border border-bgray-300 h-10 w-full focus:border-success-300 focus:ring-0 rounded-lg 
                px-3 placeholder:text-bgray-500 placeholder:text-sm" />
              <button type="button" class="absolute top-9 right-2 toggle-password" aria-label="Toggle password visibility">
                <!-- SVG eye here -->
              </button>
            </div>
            <div class="relative">
              <label for="confirm_password" class="block text-xs font-medium text-bgray-600 dark:text-bgray-50 mb-1">Confirm Password</label>
              <input id="confirm_password" name="confirm_password" type="password" placeholder="Confirm Password" required minlength="8"
                class="text-bgray-800 dark:text-white dark:bg-darkblack-500 dark:border-darkblack-400 
                border border-bgray-300 h-10 w-full focus:border-success-300 focus:ring-0 rounded-lg 
                px-3 placeholder:text-bgray-500 placeholder:text-sm" />
              <button type="button" class="absolute top-9 right-2 toggle-password" aria-label="Toggle password visibility">
                <!-- SVG eye here -->
              </button>
            </div>
          </div>

          <div class="mt-4 flex justify-between">
            <button type="button" class="prev text-white px-4 py-2 rounded" style="background-color:#60A5FA;">Back</button>
            <button type="button" class="next bg-success-300 text-white px-4 py-2 rounded">Next</button>
          </div>
        </fieldset>

        <!-- Step 3: 2FA -->
        <fieldset data-step="3">
          <div>
            <label class="text-xs text-white">Set 2FA PIN</label>
            <input
              id="pin"
              type="password"
              name="pin"
              maxlength="4"
              pattern="\d{4}"
              class="text-bgray-800 dark:text-white dark:bg-darkblack-500 dark:border-darkblack-400 
                     border border-bgray-300 h-16 w-full focus:border-success-300 focus:ring-0 
                     rounded-lg px-3 text-center font-mono tracking-[0.5em] text-3xl placeholder:text-bgray-500"
              placeholder="••••"
              required
            />
          </div>
          <div class="mt-4 flex justify-between">
            <button type="button" class="prev text-white px-4 py-2 rounded" style="background-color:#60A5FA;">Back</button>
            <button type="submit" class="bg-success-300 text-white px-4 py-2 rounded">Sign Up</button>
          </div>
        </fieldset>
      </form>
    </div>

    <p class="text-center text-bgray-900 dark:text-bgray-50 text-sm font-medium pt-4">
      Already have an account?
      <a href="{% url 'login' %}" class="font-semibold underline">Sign In</a>
    </p>
  </div>

 <div
        class="lg:w-1/2 hidden lg:flex flex-col justify-center items-center bg-[#F6FAFF] dark:bg-darkblack-600 pt-6 relative"
         >
        <ul>
          <li class="absolute top-6 left-6">
            <img src="{% static 'assets/images/shapes/square.svg' %}" alt="" class="w-6 h-6" />
          </li>
          <li class="absolute right-8 top-8">
            <img src="{% static 'assets/images/shapes/vline.svg' %}" alt="" class="w-6 h-6" />
          </li>
        </ul>
        <div class="mb-6">
          <img
            src="{% static 'assets/images/illustration/signup.svg' %}"
            alt=""
            class="illustration"
          />
        </div>
                <div class="text-center max-w-md mb-2">
                <h3
                    class="text-bgray-900 dark:text-white font-semibold font-poppins text-2xl mb-2"
                >
                    Join Belco Community Credit Union
                </h3>
                <p class="text-white text-xs font-medium">
                    Start your financial journey with Belco Community Credit Union to manage your finances with ease, access exclusive member benefits, and enjoy personalized banking services tailored to your needs.
                </p>
                </div>
         <!-- Enhanced Features Grid -->
            <div class="grid grid-cols-2 gap-4 w-full max-w-md">
                <div class="group flex items-center space-x-3 p-3 rounded-xl bg-white/10 backdrop-blur-sm border border-white/20 hover:bg-white/15 transition-all duration-300">
                    <div class="flex-shrink-0 w-8 h-8 rounded-xl bg-white/20 flex items-center justify-center group-hover:scale-110 transition-transform">
                        <i class="fas text-white fa-shield-alt text-sm"></i>
                    </div>
                    <div>
                        <h3 class="text-sm font-semibold text-white">Bank-Grade Security</h3>
                        <p class="text-xs text-white">256-bit encryption</p>
                    </div>
                </div>
                <div class="group flex items-center space-x-3 p-3 rounded-xl bg-white/10 backdrop-blur-sm border border-white/20 hover:bg-white/15 transition-all duration-300">
                    <div class="flex-shrink-0 w-8 h-8 rounded-xl bg-white/20 flex items-center justify-center group-hover:scale-110 transition-transform">
                        <i class=" text-white fas fa-bolt text-sm"></i>
                    </div>
                    <div>
                        <h3 class="text-sm text-white font-semibold">Instant Transfers</h3>
                        <p class="text-xs text-white">Real-time processing</p>
                    </div>
                </div>
                <div class="group flex items-center space-x-3 p-3 rounded-xl bg-white/10 backdrop-blur-sm border border-white/20 hover:bg-white/15 transition-all duration-300">
                    <div class="flex-shrink-0 w-8 h-8 rounded-xl bg-white/20 flex items-center justify-center group-hover:scale-110 transition-transform">
                        <i class="fas fa-globe text-white text-sm"></i>
                    </div>
                    <div>
                        <h3 class="text-sm text-white font-semibold">Global Reach</h3>
                        <p class="text-xs text-white">200+ countries</p>
                    </div>
                </div>
                <div class="group flex items-center space-x-3 p-3 rounded-xl bg-white/10 backdrop-blur-sm border border-white/20 hover:bg-white/15 transition-all duration-300">
                    <div class="flex-shrink-0 w-8 h-8 rounded-xl bg-white/20 flex items-center justify-center group-hover:scale-110 transition-transform">
                        <i class="fas text-white fa-mobile-alt text-sm"></i>
                    </div>
                    <div>
                        <h3 class="text-sm text-white font-semibold">Mobile First</h3>
                        <p class="text-xs text-white">iOS & Android</p>
                    </div>
                </div>
            </div>
</section>


 
     <script src="{% static 'assets/js/jquery-3.6.0.min.js' %}"></script>
    <script src="{% static 'assets/js/main.js' %}"></script>
    
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>


    <script>
window.registerUrl = "{% url 'register_view' %}";
window.loginUrl = "{% url 'login' %}";
const steps = document.querySelectorAll(".step"),
  fieldsets = document.querySelectorAll("fieldset");
let currentStep = 0;

function showStep(n) {
  fieldsets.forEach((fs, i) =>
    fs.classList.toggle("active", i === n)
  );
  steps.forEach((s, i) => {
    s.classList.toggle("active", i === n);
    s.classList.toggle("completed", i < n);
  });
}

// Validate inputs before moving forward
document.querySelectorAll(".next").forEach(btn =>
  btn.addEventListener("click", () => {
    const fields = fieldsets[currentStep].querySelectorAll("input, select");
    for (let field of fields) {
      if (!field.checkValidity()) {
        field.reportValidity();
        return; // stop if any invalid field
      }
    }
    if (currentStep < fieldsets.length - 1) {
      currentStep++;
      showStep(currentStep);
    }
  })
);

document.querySelectorAll(".prev").forEach(btn =>
  btn.addEventListener("click", () => {
    if (currentStep > 0) {
      currentStep--;
      showStep(currentStep);
    }
  })
);

showStep(currentStep);

// Password toggle
document.querySelectorAll(".toggle-password").forEach(btn =>
  btn.addEventListener("click", () => {
    const input = btn.parentElement.querySelector("input");
    input.type = input.type === "password" ? "text" : "password";
    btn.innerHTML =
      input.type === "password"
        ? '<i class="fas fa-eye"></i>'
        : '<i class="fas fa-eye-slash"></i>';
  })
);

// Spinner + Alerts
function showSpinner() {
  document.getElementById("spinner").classList.remove("hidden");
}

function hideSpinner() {
  document.getElementById("spinner").classList.add("hidden");
}

function showAlert(msg, type = "info", url = null) {
  console.log(`Showing alert: ${msg}, Type: ${type}, URL: ${url}`); // Debug alert
  Toastify({
    text: msg,
    duration: type === "success" ? 2000 : 4000, // 3s for success, 4s for others
    close: true,
    gravity: "top",
    position: "right",
    stopOnFocus: true,
    style: {
      background: type === "success"
        ? "linear-gradient(135deg, #1a3c34, #00c853)"
        : "linear-gradient(135deg, #3c1a1a, #ff1744)",
      color: "#fff",
      borderRadius: "10px",
      boxShadow: "0 6px 16px rgba(0,0,0,0.4)",
      fontFamily: "'Arial', sans-serif",
      fontSize: "16px",
      fontWeight: "500",
      padding: "12px 20px",
      maxWidth: "300px",
      lineHeight: "1.4",
      border: "1px solid rgba(255,255,255,0.1)",
    },
    onClick: function() {
      if (url && type !== "success") { // Only redirect on click for non-success messages
        window.location.href = url;
      }
    }
  }).showToast();

  // Auto-redirect for success after 3 seconds
  if (type === "success" && url) {
    setTimeout(() => {
      window.location.href = url;
    }, 3000);
  }
}

// Registration
async function registration(e) {
  e.preventDefault();
  showSpinner();
  
  // Ensure minimum spinner duration (500ms)
  const minSpinnerTime = new Promise(resolve => setTimeout(resolve, 500));
  
  const f = document.getElementById("signup"),
    fd = new FormData(f),
    p = fd.get("password"),
    cp = fd.get("confirm_password");

  if (p !== cp) {
    await minSpinnerTime;
    hideSpinner();
    showAlert("Passwords do not match", "error");
    return;
  }

  // Ensure registerUrl is defined
  if (!window.registerUrl) {
    await minSpinnerTime;
    hideSpinner();
    showAlert("Registration URL not configured", "error");
    console.error("window.registerUrl is not defined");
    return;
  }

  try {
    const response = await fetch(window.registerUrl, {
      method: "POST",
      body: fd,
      headers: {
        "X-CSRFToken": f.querySelector('[name=csrfmiddlewaretoken]')?.value || getCSRFToken(),
      },
    });

    console.log("Fetch response status:", response.status, response.statusText); // Debug response
    if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
    
    const d = await response.json();
    console.log("Response JSON:", d); // Debug JSON
    
    // Ensure spinner shows for at least 500ms
    await minSpinnerTime;
    hideSpinner();
    
    if (d.success) {
      showAlert(
        d.message || "Registration successful!",
        "success",
        d.redirect_url || window.loginUrl || "/login/"
      );
    } else {
      showAlert(
        d.message || "Please check your details and try again.",
        "error"
      );
    }
  } catch (err) {
    await minSpinnerTime;
    hideSpinner();
    showAlert("Something went wrong: " + err.message, "error");
    console.error("Fetch error:", err);
  }
}

// Fallback CSRF token retrieval from cookies
function getCSRFToken() {
  const name = 'csrftoken';
  const cookies = document.cookie.split(';');
  for (let cookie of cookies) {
    const [key, value] = cookie.trim().split('=');
    if (key === name) return value;
  }
  console.error("CSRF token not found in cookies");
  return null;
}
</script>

<style>
  /* ✅ Button animations */
  button.next,
  button.prev,
  button[type="submit"] {
    transition: all 0.2s ease;
  }
  button.next:active,
  button.prev:active,
  button[type="submit"]:active {
    transform: scale(0.95);
  }
  button.next:hover,
  button.prev:hover,
  button[type="submit"]:hover {
    opacity: 0.9;
  }
</style>

<script>
window.addEventListener('load', () => {
    const preloader = document.querySelector('.page-loading');
    
    // Ensure it stays visible for at least 1.5s
    setTimeout(() => {
        preloader.classList.remove('active');

        setTimeout(() => {
            preloader.style.display = 'none';
        }, 1500); // match the fade duration
    }, 1500); // minimum display time
});
</script>


  </body>
</html>
